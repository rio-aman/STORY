<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metaphor Generator</title>
    <link rel="stylesheet" href="style.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="stylesheet" href="loader.css">
</head>

<body>
<!-- Metaphor Generator -->
<div class="generator">
    <h2>Metaphor Generator</h2>
    <form id="metaphorForm">
        <label for="theme">Theme:</label>
        <input type="text" id="theme" placeholder="Theme for the metaphor" required />
        <button type="submit">Generate Metaphor</button>
    </form>
    <div id="loadingMessage" class="hidden">
        <div class="loader" id="loader"></div>
    </div>
    <div id="metaphorOutput" class="output"></div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const metaphorForm = document.getElementById("metaphorForm");
        const metaphorOutput = document.getElementById("metaphorOutput");

        metaphorForm.addEventListener("submit", async (event) => {
            event.preventDefault();
            loadingMessage.classList.remove("hidden");
            const theme = document.getElementById("theme").value;

            if (!theme) {
                metaphorOutput.innerHTML = "<p>Please enter a theme.</p>";
                return;
            }

            try {
                const metaphor = await generateMetaphorWithAI(theme);
                loadingMessage.classList.add("hidden");
                console.log(metaphor)
                metaphorOutput.innerHTML = `<h2>Generated Metaphor</h2><p>${metaphor}</p>`;
            } catch (error) {
                loadingMessage.classList.add("hidden");
                metaphorOutput.innerHTML = `<p>Failed to generate metaphor: ${error.message}</p>`;
            }
        });

        // Function to call Gemini AI API to generate a metaphor
        async function generateMetaphorWithAI(theme) {
            const apiKey = "AIzaSyCI1NL5htAgGL9dFHXBiReIkdH-S_PLZHA"; // Replace with your actual API key
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;

            // Define the payload structure for generating a metaphor
            const payload = {
                contents: [
                    {
                        parts: [
                            {
                                text: `Generate a metaphor for the theme of ${theme}.`,
                            },
                        ],
                    },
                ],
            };

            try {
                const response = await fetch(apiUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(payload), // Use the defined payload here
                });

                if (!response.ok) {
                    throw new Error(`API call failed: ${response.statusText}`);
                }

                const data = await response.json();
                return (
                    data?.candidates[0].content.parts[0].text ||
                    "No metaphor generated. Try again later."
                );
            } catch (error) {
                throw error;
            }
        }
    });
</script>
</body>
</html>
